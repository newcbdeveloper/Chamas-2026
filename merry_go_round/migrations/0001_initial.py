# Generated by Django 5.2.7 on 2025-11-21 08:21

import django.core.validators
import django.db.models.deletion
import uuid
from decimal import Decimal
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='Contribution',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('amount', models.DecimalField(decimal_places=2, max_digits=10)),
                ('cycle_number', models.IntegerField(help_text='Contribution cycle number')),
                ('due_date', models.DateField()),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('processing', 'Processing'), ('completed', 'Completed'), ('failed', 'Failed'), ('missed', 'Missed')], default='pending', max_length=15)),
                ('payment_date', models.DateTimeField(blank=True, null=True)),
                ('interest_accrued', models.DecimalField(decimal_places=2, default=0.0, max_digits=10)),
                ('days_in_escrow', models.IntegerField(default=0)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Contribution',
                'verbose_name_plural': 'Contributions',
                'db_table': 'mgr_contribution',
                'ordering': ['due_date', 'cycle_number'],
            },
        ),
        migrations.CreateModel(
            name='MGRTransaction',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('transaction_type', models.CharField(choices=[('deposit', 'Deposit from Main Wallet'), ('withdraw', 'Withdraw to Main Wallet'), ('contribution', 'Round Contribution'), ('payout', 'Round Payout'), ('lock', 'Funds Locked'), ('unlock', 'Funds Unlocked'), ('interest', 'Interest Earned'), ('refund', 'Refund')], max_length=20)),
                ('amount', models.DecimalField(decimal_places=2, max_digits=12)),
                ('balance_before', models.DecimalField(decimal_places=2, max_digits=12)),
                ('balance_after', models.DecimalField(decimal_places=2, max_digits=12)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('completed', 'Completed'), ('failed', 'Failed'), ('reversed', 'Reversed')], default='pending', max_length=15)),
                ('main_wallet_reference', models.CharField(blank=True, help_text='Reference from main ChamaSpace wallet', max_length=100)),
                ('description', models.TextField(blank=True)),
                ('metadata', models.JSONField(blank=True, default=dict)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('related_contribution', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='merry_go_round.contribution')),
            ],
            options={
                'verbose_name': 'Transaction',
                'verbose_name_plural': 'Transactions',
                'db_table': 'mgr_transaction',
                'ordering': ['-created_at'],
            },
        ),
        migrations.AddField(
            model_name='contribution',
            name='wallet_transaction',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='contribution_record', to='merry_go_round.mgrtransaction'),
        ),
        migrations.CreateModel(
            name='MGRWallet',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('balance', models.DecimalField(decimal_places=2, default=0.0, help_text='Total wallet balance', max_digits=12)),
                ('available_balance', models.DecimalField(decimal_places=2, default=0.0, help_text='Available balance (not locked in rounds)', max_digits=12)),
                ('locked_balance', models.DecimalField(decimal_places=2, default=0.0, help_text='Balance locked in active rounds', max_digits=12)),
                ('total_deposited', models.DecimalField(decimal_places=2, default=0.0, help_text='Total amount deposited from main wallet', max_digits=12)),
                ('total_withdrawn', models.DecimalField(decimal_places=2, default=0.0, help_text='Total amount withdrawn to main wallet', max_digits=12)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='mgr_wallet', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'MGR Wallet',
                'verbose_name_plural': 'MGR Wallets',
                'db_table': 'mgr_wallet',
            },
        ),
        migrations.AddField(
            model_name='mgrtransaction',
            name='wallet',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='transactions', to='merry_go_round.mgrwallet'),
        ),
        migrations.CreateModel(
            name='Payout',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('payout_cycle', models.IntegerField(help_text='Cycle number for this payout')),
                ('amount', models.DecimalField(decimal_places=2, max_digits=12)),
                ('principal_amount', models.DecimalField(decimal_places=2, max_digits=12)),
                ('interest_amount', models.DecimalField(decimal_places=2, default=0.0, max_digits=12)),
                ('scheduled_date', models.DateField()),
                ('payout_date', models.DateTimeField(blank=True, null=True)),
                ('status', models.CharField(choices=[('scheduled', 'Scheduled'), ('processing', 'Processing'), ('completed', 'Completed'), ('failed', 'Failed')], default='scheduled', max_length=15)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('wallet_transaction', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='payout_record', to='merry_go_round.mgrtransaction')),
            ],
            options={
                'verbose_name': 'Payout',
                'verbose_name_plural': 'Payouts',
                'db_table': 'mgr_payout',
                'ordering': ['scheduled_date', 'payout_cycle'],
            },
        ),
        migrations.AddField(
            model_name='mgrtransaction',
            name='related_payout',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='merry_go_round.payout'),
        ),
        migrations.CreateModel(
            name='Round',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=200)),
                ('description', models.TextField(blank=True)),
                ('round_type', models.CharField(choices=[('public', 'Public'), ('private', 'Private')], default='public', max_length=10)),
                ('payout_model', models.CharField(choices=[('marathon', 'Marathon'), ('rotational', 'Rotational')], default='marathon', max_length=15)),
                ('contribution_amount', models.DecimalField(decimal_places=2, help_text='Amount each member contributes per cycle', max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('100.00'))])),
                ('frequency', models.CharField(choices=[('weekly', 'Weekly'), ('biweekly', 'Bi-weekly'), ('monthly', 'Monthly')], default='monthly', max_length=10)),
                ('max_members', models.IntegerField(help_text='Maximum number of members allowed', validators=[django.core.validators.MinValueValidator(2), django.core.validators.MaxValueValidator(100)])),
                ('current_members', models.IntegerField(default=0)),
                ('interest_rate', models.DecimalField(decimal_places=2, default=12.0, help_text='Annual interest rate percentage', max_digits=5)),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('open', 'Open for Joining'), ('active', 'Active'), ('completed', 'Completed'), ('cancelled', 'Cancelled')], default='draft', max_length=15)),
                ('start_date', models.DateField(blank=True, null=True)),
                ('end_date', models.DateField(blank=True, null=True)),
                ('next_contribution_date', models.DateField(blank=True, null=True)),
                ('total_pool', models.DecimalField(decimal_places=2, default=0.0, max_digits=12)),
                ('total_interest_earned', models.DecimalField(decimal_places=2, default=0.0, max_digits=12)),
                ('min_trust_score', models.IntegerField(default=30, help_text='Minimum trust score required to join', validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('creator', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='created_rounds', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Round',
                'verbose_name_plural': 'Rounds',
                'db_table': 'mgr_round',
                'ordering': ['-created_at'],
            },
        ),
        migrations.AddField(
            model_name='payout',
            name='round',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='payouts', to='merry_go_round.round'),
        ),
        migrations.CreateModel(
            name='Notification',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('notification_type', models.CharField(choices=[('contribution_due', 'Contribution Due'), ('contribution_reminder', 'Contribution Reminder'), ('payment_received', 'Payment Received'), ('payout_scheduled', 'Payout Scheduled'), ('payout_received', 'Payout Received'), ('round_started', 'Round Started'), ('round_completed', 'Round Completed'), ('invitation_received', 'Invitation Received'), ('member_joined', 'Member Joined'), ('member_defaulted', 'Member Defaulted'), ('insufficient_balance', 'Insufficient Balance'), ('funds_locked', 'Funds Locked')], max_length=30)),
                ('title', models.CharField(max_length=200)),
                ('message', models.TextField()),
                ('is_read', models.BooleanField(default=False)),
                ('is_sent', models.BooleanField(default=False)),
                ('action_url', models.CharField(blank=True, max_length=500)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('read_at', models.DateTimeField(blank=True, null=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='mgr_notifications', to=settings.AUTH_USER_MODEL)),
                ('round', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='notifications', to='merry_go_round.round')),
            ],
            options={
                'verbose_name': 'Notification',
                'verbose_name_plural': 'Notifications',
                'db_table': 'mgr_notification',
                'ordering': ['-created_at'],
            },
        ),
        migrations.AddField(
            model_name='mgrtransaction',
            name='related_round',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='merry_go_round.round'),
        ),
        migrations.CreateModel(
            name='Invitation',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('invitee_email', models.EmailField(blank=True, max_length=254)),
                ('invitee_phone', models.CharField(blank=True, max_length=15)),
                ('token', models.CharField(max_length=100, unique=True)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('accepted', 'Accepted'), ('declined', 'Declined'), ('expired', 'Expired')], default='pending', max_length=15)),
                ('message', models.TextField(blank=True)),
                ('expires_at', models.DateTimeField()),
                ('accepted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('invitee_user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='received_invitations', to=settings.AUTH_USER_MODEL)),
                ('inviter', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='sent_invitations', to=settings.AUTH_USER_MODEL)),
                ('round', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='invitations', to='merry_go_round.round')),
            ],
            options={
                'verbose_name': 'Invitation',
                'verbose_name_plural': 'Invitations',
                'db_table': 'mgr_invitation',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='RoundMembership',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('payout_position', models.IntegerField(blank=True, help_text='Position in payout rotation (for rotational model)', null=True)),
                ('trust_score_at_join', models.IntegerField(help_text='Trust score when member joined', validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('active', 'Active'), ('defaulted', 'Defaulted'), ('completed', 'Completed'), ('removed', 'Removed')], default='pending', max_length=15)),
                ('total_contributed', models.DecimalField(decimal_places=2, default=0.0, max_digits=10)),
                ('interest_earned', models.DecimalField(decimal_places=2, default=0.0, max_digits=10)),
                ('expected_contributions', models.DecimalField(decimal_places=2, default=0.0, max_digits=10)),
                ('locked_amount', models.DecimalField(decimal_places=2, default=0.0, help_text="Amount locked in user's wallet for this round", max_digits=10)),
                ('contributions_made', models.IntegerField(default=0)),
                ('contributions_missed', models.IntegerField(default=0)),
                ('has_received_payout', models.BooleanField(default=False)),
                ('payout_received_date', models.DateField(blank=True, null=True)),
                ('payout_amount', models.DecimalField(decimal_places=2, default=0.0, max_digits=12)),
                ('join_date', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('round', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='memberships', to='merry_go_round.round')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='round_memberships', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Round Membership',
                'verbose_name_plural': 'Round Memberships',
                'db_table': 'mgr_round_membership',
                'ordering': ['payout_position', 'join_date'],
                'unique_together': {('round', 'user')},
            },
        ),
        migrations.AddField(
            model_name='payout',
            name='recipient_membership',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='received_payouts', to='merry_go_round.roundmembership'),
        ),
        migrations.AddField(
            model_name='contribution',
            name='membership',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='contributions', to='merry_go_round.roundmembership'),
        ),
        migrations.CreateModel(
            name='RoundMessage',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('message_type', models.CharField(choices=[('system', 'System'), ('user', 'User'), ('admin', 'Admin')], default='user', max_length=10)),
                ('subject', models.CharField(blank=True, max_length=200)),
                ('content', models.TextField()),
                ('is_pinned', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('round', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='messages', to='merry_go_round.round')),
                ('sender', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='round_messages', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Round Message',
                'verbose_name_plural': 'Round Messages',
                'db_table': 'mgr_round_message',
                'ordering': ['-is_pinned', '-created_at'],
            },
        ),
        migrations.CreateModel(
            name='UserProfile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('trust_score', models.IntegerField(default=50, help_text='Trust score from 0-100 based on payment history', validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('total_contributions', models.DecimalField(decimal_places=2, default=0.0, help_text='Total amount contributed across all rounds', max_digits=12)),
                ('completed_rounds', models.IntegerField(default=0, help_text='Number of successfully completed rounds')),
                ('missed_payments', models.IntegerField(default=0, help_text='Total number of missed payments')),
                ('phone_number', models.CharField(blank=True, max_length=15)),
                ('email_verified', models.BooleanField(default=False)),
                ('phone_verified', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='mgr_profile', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'User Profile',
                'verbose_name_plural': 'User Profiles',
                'db_table': 'mgr_user_profile',
            },
        ),
        migrations.AlterUniqueTogether(
            name='contribution',
            unique_together={('membership', 'cycle_number')},
        ),
    ]
